{"version":3,"file":"4372.64d61719.js","mappings":"68CAWO,SAASA,IACd,MAAM,QAAEC,IAAYC,EAAAA,EAAAA,aACdC,GAAWC,EAAAA,EAAAA,eACXC,GAAUC,EAAAA,EAAAA,wBACVC,EAAQC,OAAOC,EAAAA,OAAOC,SAASC,KAAKJ,OAAS,MAC5CK,EAAeC,IAAoBC,EAAAA,EAAAA,UAAmC,OACtEC,EAASC,IAAcF,EAAAA,EAAAA,WAAS,IAChCG,EAAOC,IAAYJ,EAAAA,EAAAA,UAAwB,OAC3CK,EAAWC,IAAgBN,EAAAA,EAAAA,WAAS,IAE3CO,EAAAA,EAAAA,WAAU,KACR,IAAKpB,EAGH,OAFAiB,EAAS,6BACTF,GAAW,GAIa,cACxB,IACE,MAAMM,QAAgBC,EAAAA,EAAoBC,iBAAiBvB,GAC3DY,EAAiBS,EACnB,CAAE,MAAOG,GACPC,QAAQT,MAAM,iDAAkDQ,GAC5C,OAAhBA,aAAAA,EAAAA,EAAKE,QACPT,EAAS,gDACgB,OAAhBO,aAAAA,EAAAA,EAAKE,QACdT,EAAS,0FAETA,EAAS,yDAEb,CAAE,QACAF,GAAW,EACb,CACF,EAhB0B,IAmBzB,CAACf,IAmCJ,GAAIc,EACF,OACE,kBAACa,MAAAA,CAAIC,UAAU,sDACb,kBAACD,MAAAA,CAAIC,UAAU,eACb,kBAACC,IAAAA,KAAE,+BAMX,GAAIb,IAAUL,EACZ,OACE,kBAACgB,MAAAA,CAAIC,UAAU,0DACb,kBAACD,MAAAA,CAAIC,UAAU,mBACb,kBAACE,EAAAA,MAAKA,CAACC,MAAM,QAAQC,SAAS,SAC3BhB,GAAS,iCAEZ,kBAACW,MAAAA,CAAIC,UAAU,QACb,kBAACK,EAAAA,OAAMA,CAACC,QAAQ,UAAUC,QAAS,IAAMjC,EAAS,MAAM,iBAUlE,MAAMkC,EAA0BzB,EAAcyB,SAASC,IAAKC,GAAc,OACrEA,GAAAA,CACHC,UAAW,IAAIC,KAAKF,EAAIC,WAAaC,KAAKC,UAGtCpB,EAAUqB,EAAAA,EAAYC,YAAY,CACtCC,GAAIjC,EAAciC,GAClBb,MAAOpB,EAAcoB,MACrBK,SAAUA,EACVS,UAAWlC,EAAckC,UACzBC,UAAWnC,EAAcmC,UACzBC,aAAcX,EAASY,SAMzB,OACE,kBAACrB,MAAAA,CAAIC,UAAU,mCACb,kBAACD,MAAAA,CAAIC,UAAU,gDACb,kBAACD,MAAAA,CAAIC,UAAU,qCACb,kBAACD,MAAAA,KACC,kBAACsB,KAAAA,CAAGrB,UAAU,sCAAqC,0BACnD,kBAACC,IAAAA,CAAED,UAAU,iCAAgC,4EAI/C,kBAACK,EAAAA,OAAMA,CAACC,QAAQ,UAAUgB,KAAK,KAAKf,QAxFvB,kBACnB,GAAKxB,EAAL,CAIAQ,GAAa,GACb,IACE,MAAMgC,EAAiBC,EAAAA,EAAeC,kBAAkBjD,GAGlDgC,EAA0BzB,EAAcyB,SAASC,IAAKC,GAAc,OACrEA,GAAAA,CACHC,UAAW,IAAIC,KAAKF,EAAIC,WAAaC,KAAKC,gBAKtCU,EAAeG,cAAchD,EAAO8B,EAAUzB,EAAcoB,aAG5D,IAAIwB,QAASC,GAAYC,WAAWD,EAAS,MAInDtD,EAAS,KAAM,CAAEwD,SAAS,GAC5B,CAAE,MAAOlC,GACPC,QAAQT,MAAM,4CAA6CQ,GAC3DmC,MAAM,8CACR,CAAE,QACAxC,GAAa,EACf,CA3BA,CA4BF,EA/BqB,GAwF8CyC,SAAU1C,GAClEA,EAAY,eAAiB,2BAIpC,kBAACS,MAAAA,CAAIC,UAAU,gCACb,kBAACiC,EAAAA,GAAIA,CAACC,eAlBmC,CAAC,EAkBCC,UAAU,EAAMC,eAAgB3C,KAInF,CAEA,S","sources":["webpack://consensys-asko11y-app/./pages/SharedSession.tsx"],"sourcesContent":["import React, { useEffect, useState } from 'react';\nimport { useParams, useNavigate } from 'react-router-dom';\nimport { Alert, Button } from '@grafana/ui';\nimport { sessionShareService, SharedSession as SharedSessionType } from '../services/sessionShare';\nimport { Chat } from '../components/Chat';\nimport { ServiceFactory } from '../core/services/ServiceFactory';\nimport { usePluginUserStorage, config } from '@grafana/runtime';\nimport { ChatSession } from '../core/models/ChatSession';\nimport { ChatMessage } from '../components/Chat/types';\nimport type { AppPluginSettings } from '../types/plugin';\n\nexport function SharedSession() {\n  const { shareId } = useParams<{ shareId: string }>();\n  const navigate = useNavigate();\n  const storage = usePluginUserStorage();\n  const orgId = String(config.bootData.user.orgId || '1');\n  const [sharedSession, setSharedSession] = useState<SharedSessionType | null>(null);\n  const [loading, setLoading] = useState(true);\n  const [error, setError] = useState<string | null>(null);\n  const [importing, setImporting] = useState(false);\n\n  useEffect(() => {\n    if (!shareId) {\n      setError('Share ID is required');\n      setLoading(false);\n      return;\n    }\n\n    const loadSharedSession = async () => {\n      try {\n        const session = await sessionShareService.getSharedSession(shareId);\n        setSharedSession(session);\n      } catch (err: any) {\n        console.error('[SharedSession] Failed to load shared session:', err);\n        if (err?.status === 404) {\n          setError('This share link is not found or has expired.');\n        } else if (err?.status === 403) {\n          setError(\"You don't have access to this shared session. It may be from a different organization.\");\n        } else {\n          setError('Failed to load shared session. Please try again later.');\n        }\n      } finally {\n        setLoading(false);\n      }\n    };\n\n    loadSharedSession();\n  }, [shareId]);\n\n  const handleImport = async () => {\n    if (!sharedSession) {\n      return;\n    }\n\n    setImporting(true);\n    try {\n      const sessionService = ServiceFactory.getSessionService(storage);\n\n      // Convert shared session to ChatSession format\n      const messages: ChatMessage[] = sharedSession.messages.map((msg: any) => ({\n        ...msg,\n        timestamp: new Date(msg.timestamp || Date.now()),\n      }));\n\n      // Create new session with imported data\n      // createSession already sets it as the active session, so we don't need to call setActiveSession\n      await sessionService.createSession(orgId, messages, sharedSession.title);\n\n      // Wait a brief moment to ensure the session is fully persisted\n      await new Promise((resolve) => setTimeout(resolve, 100));\n\n      // Navigate to home - use relative path to go up one level from /shared/:shareId\n      // This keeps us within the plugin's router context\n      navigate('..', { replace: true });\n    } catch (err) {\n      console.error('[SharedSession] Failed to import session:', err);\n      alert('Failed to import session. Please try again.');\n    } finally {\n      setImporting(false);\n    }\n  };\n\n  if (loading) {\n    return (\n      <div className=\"min-h-full w-full flex items-center justify-center\">\n        <div className=\"text-center\">\n          <p>Loading shared session...</p>\n        </div>\n      </div>\n    );\n  }\n\n  if (error || !sharedSession) {\n    return (\n      <div className=\"min-h-full w-full flex items-center justify-center p-4\">\n        <div className=\"max-w-md w-full\">\n          <Alert title=\"Error\" severity=\"error\">\n            {error || 'Failed to load shared session'}\n          </Alert>\n          <div className=\"mt-4\">\n            <Button variant=\"primary\" onClick={() => navigate('/')}>\n              Go to Home\n            </Button>\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  // Convert shared session to ChatSession for display\n  const messages: ChatMessage[] = sharedSession.messages.map((msg: any) => ({\n    ...msg,\n    timestamp: new Date(msg.timestamp || Date.now()),\n  }));\n\n  const session = ChatSession.fromStorage({\n    id: sharedSession.id,\n    title: sharedSession.title,\n    messages: messages,\n    createdAt: sharedSession.createdAt,\n    updatedAt: sharedSession.updatedAt,\n    messageCount: messages.length,\n  });\n\n  // Empty plugin settings for read-only mode\n  const emptyPluginSettings: AppPluginSettings = {};\n\n  return (\n    <div className=\"min-h-full w-full flex flex-col\">\n      <div className=\"bg-primary/10 border-b border-primary/20 p-2\">\n        <div className=\"flex items-center justify-between\">\n          <div>\n            <h2 className=\"text-sm font-semibold text-primary\">Viewing Shared Session</h2>\n            <p className=\"text-xs text-secondary mt-0.5\">\n              This is a shared session. You can view it or import it to your account.\n            </p>\n          </div>\n          <Button variant=\"primary\" size=\"sm\" onClick={handleImport} disabled={importing}>\n            {importing ? 'Importing...' : 'Import as New Session'}\n          </Button>\n        </div>\n      </div>\n      <div className=\"flex-1 flex flex-col min-h-0\">\n        <Chat pluginSettings={emptyPluginSettings} readOnly={true} initialSession={session} />\n      </div>\n    </div>\n  );\n}\n\nexport default SharedSession;\n"],"names":["SharedSession","shareId","useParams","navigate","useNavigate","storage","usePluginUserStorage","orgId","String","config","bootData","user","sharedSession","setSharedSession","useState","loading","setLoading","error","setError","importing","setImporting","useEffect","session","sessionShareService","getSharedSession","err","console","status","div","className","p","Alert","title","severity","Button","variant","onClick","messages","map","msg","timestamp","Date","now","ChatSession","fromStorage","id","createdAt","updatedAt","messageCount","length","h2","size","sessionService","ServiceFactory","getSessionService","createSession","Promise","resolve","setTimeout","replace","alert","disabled","Chat","pluginSettings","readOnly","initialSession"],"ignoreList":[],"sourceRoot":""}