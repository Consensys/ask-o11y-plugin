{"version":3,"file":"202.7ae07c24.js","mappings":"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","sources":["webpack://consensys-asko11y-app/./components/testIds.ts","webpack://consensys-asko11y-app/./components/AppConfig/AppConfig.tsx"],"sourcesContent":["export const testIds = {\n  appConfig: {\n    apiKey: 'data-testid ac-api-key',\n    apiUrl: 'data-testid ac-api-url',\n    maxTotalTokens: 'data-testid ac-max-total-tokens',\n    submit: 'data-testid ac-submit-form',\n    // MCP Server test IDs\n    addMcpServerButton: 'data-testid ac-add-mcp-server',\n    saveMcpServersButton: 'data-testid ac-save-mcp-servers',\n    mcpServerCard: (id: string) => `data-testid ac-mcp-server-${id}`,\n    mcpServerNameInput: (id: string) => `data-testid ac-mcp-server-name-${id}`,\n    mcpServerUrlInput: (id: string) => `data-testid ac-mcp-server-url-${id}`,\n    mcpServerRemoveButton: (id: string) => `data-testid ac-mcp-server-remove-${id}`,\n    mcpServerAdvancedToggle: (id: string) => `data-testid ac-mcp-server-advanced-${id}`,\n    mcpServerAddHeaderButton: (id: string) => `data-testid ac-mcp-server-add-header-${id}`,\n    mcpServerHeaderKeyInput: (id: string, index: number) => `data-testid ac-mcp-server-header-key-${id}-${index}`,\n    mcpServerHeaderValueInput: (id: string, index: number) => `data-testid ac-mcp-server-header-value-${id}-${index}`,\n    mcpServerHeaderRemoveButton: (id: string, index: number) =>\n      `data-testid ac-mcp-server-header-remove-${id}-${index}`,\n    // System Prompt test IDs\n    systemPromptModeSelector: 'data-testid ac-system-prompt-mode',\n    customSystemPromptTextarea: 'data-testid ac-custom-system-prompt',\n    customSystemPromptCharCount: 'data-testid ac-custom-prompt-char-count',\n    viewDefaultPromptButton: 'data-testid ac-view-default-prompt',\n    saveSystemPromptButton: 'data-testid ac-save-system-prompt',\n    defaultPromptModal: 'data-testid ac-default-prompt-modal',\n    defaultPromptContent: 'data-testid ac-default-prompt-content',\n    copyDefaultPromptButton: 'data-testid ac-copy-default-prompt',\n    closeDefaultPromptButton: 'data-testid ac-close-default-prompt',\n  },\n  home: {\n    container: 'data-testid home-container',\n  },\n};\n","import React, { ChangeEvent, useState } from 'react';\nimport { lastValueFrom } from 'rxjs';\nimport { AppPluginMeta, PluginConfigPageProps, PluginMeta } from '@grafana/data';\nimport { getBackendSrv } from '@grafana/runtime';\nimport { Button, Field, FieldSet, Input, Icon, Switch, Alert, RadioButtonGroup, TextArea, Modal } from '@grafana/ui';\nimport { testIds } from '../testIds';\nimport { ValidationService } from '../../services/validation';\nimport { SYSTEM_PROMPT } from '../Chat/constants';\nimport type { AppPluginSettings, MCPServerConfig, SystemPromptMode } from '../../types/plugin';\n\nconst PROMPT_MODE_OPTIONS = [\n  { label: 'Use default prompt', value: 'default' as SystemPromptMode },\n  { label: 'Replace with custom prompt', value: 'replace' as SystemPromptMode },\n  { label: 'Append to default prompt', value: 'append' as SystemPromptMode },\n];\n\ntype State = {\n  // Maximum total tokens for LLM requests\n  maxTotalTokens: number;\n  // MCP server configurations\n  mcpServers: MCPServerConfig[];\n  // System prompt configuration\n  systemPromptMode: SystemPromptMode;\n  customSystemPrompt: string;\n  // Track which servers have advanced options expanded\n  expandedAdvanced: Set<string>;\n};\n\ntype ValidationErrors = {\n  maxTotalTokens?: string;\n  mcpServers: { [id: string]: { name?: string; url?: string } };\n  customSystemPrompt?: string;\n};\n\nexport interface AppConfigProps extends PluginConfigPageProps<AppPluginMeta<AppPluginSettings>> {}\n\nconst AppConfig = ({ plugin }: AppConfigProps) => {\n  const { enabled, pinned, jsonData } = plugin.meta;\n  const [state, setState] = useState<State>({\n    maxTotalTokens: jsonData?.maxTotalTokens || 50000,\n    mcpServers: jsonData?.mcpServers || [],\n    systemPromptMode: jsonData?.systemPromptMode || 'default',\n    customSystemPrompt: jsonData?.customSystemPrompt || '',\n    expandedAdvanced: new Set<string>(),\n  });\n  const [validationErrors, setValidationErrors] = useState<ValidationErrors>({\n    mcpServers: {},\n  });\n  const [showDefaultPromptModal, setShowDefaultPromptModal] = useState(false);\n  const [copySuccess, setCopySuccess] = useState(false);\n\n  const isLLMSettingsDisabled = Boolean(!state.maxTotalTokens || state.maxTotalTokens < 1000);\n\n  const onChange = (event: ChangeEvent<HTMLInputElement>) => {\n    const { name, value, type } = event.target;\n    const parsedValue = type === 'number' ? parseInt(value, 10) || 0 : value.trim();\n\n    setState({\n      ...state,\n      [name]: parsedValue,\n    });\n\n    // Validate token limit\n    if (name === 'maxTotalTokens') {\n      try {\n        ValidationService.validateConfigValue('tokenLimit', parsedValue);\n        setValidationErrors((prev) => ({ ...prev, maxTotalTokens: undefined }));\n      } catch (error) {\n        setValidationErrors((prev) => ({\n          ...prev,\n          maxTotalTokens: error instanceof Error ? error.message : 'Invalid value',\n        }));\n      }\n    }\n  };\n\n  const addMCPServer = () => {\n    const newServer: MCPServerConfig = {\n      id: `mcp-${Date.now()}`,\n      name: 'New MCP Server',\n      url: '',\n      enabled: true,\n      type: 'openapi',\n    };\n    setState({\n      ...state,\n      mcpServers: [...state.mcpServers, newServer],\n    });\n  };\n\n  const updateMCPServer = (id: string, updates: Partial<MCPServerConfig>) => {\n    // Update state\n    setState({\n      ...state,\n      mcpServers: state.mcpServers.map((server) => (server.id === id ? { ...server, ...updates } : server)),\n    });\n\n    // Validate the updates\n    const newErrors = { ...validationErrors.mcpServers };\n\n    if (updates.url !== undefined) {\n      if (updates.url.trim()) {\n        try {\n          ValidationService.validateMCPServerURL(updates.url);\n          // Clear URL error for this server\n          if (newErrors[id]) {\n            delete newErrors[id].url;\n            if (Object.keys(newErrors[id]).length === 0) {\n              delete newErrors[id];\n            }\n          }\n        } catch (error) {\n          // Set URL error for this server\n          if (!newErrors[id]) {\n            newErrors[id] = {};\n          }\n          newErrors[id].url = error instanceof Error ? error.message : 'Invalid URL';\n        }\n      }\n    }\n\n    if (updates.name !== undefined) {\n      if (!updates.name.trim()) {\n        // Set name error for this server\n        if (!newErrors[id]) {\n          newErrors[id] = {};\n        }\n        newErrors[id].name = 'Server name is required';\n      } else {\n        // Clear name error for this server\n        if (newErrors[id]) {\n          delete newErrors[id].name;\n          if (Object.keys(newErrors[id]).length === 0) {\n            delete newErrors[id];\n          }\n        }\n      }\n    }\n\n    setValidationErrors((prev) => ({ ...prev, mcpServers: newErrors }));\n  };\n\n  const removeMCPServer = (id: string) => {\n    setState({\n      ...state,\n      mcpServers: state.mcpServers.filter((server) => server.id !== id),\n    });\n  };\n\n  const toggleAdvancedOptions = (id: string) => {\n    setState((prev) => {\n      const newExpanded = new Set(prev.expandedAdvanced);\n      if (newExpanded.has(id)) {\n        newExpanded.delete(id);\n      } else {\n        newExpanded.add(id);\n      }\n      return { ...prev, expandedAdvanced: newExpanded };\n    });\n  };\n\n  // Counter for generating unique header IDs (survives rapid clicks within same millisecond)\n  const headerIdCounterRef = React.useRef(0);\n\n  const addHeader = (serverId: string) => {\n    const server = state.mcpServers.find((s) => s.id === serverId);\n    if (!server) {\n      return;\n    }\n\n    const currentHeaders = server.headers || {};\n    const headerCount = Object.keys(currentHeaders).length;\n\n    // Max 10 headers\n    if (headerCount >= 10) {\n      return;\n    }\n\n    // Use a combination of timestamp and counter to ensure uniqueness even with rapid clicks\n    headerIdCounterRef.current += 1;\n    const tempKey = `__new_header_${Date.now()}_${headerIdCounterRef.current}`;\n\n    updateMCPServer(serverId, {\n      headers: { ...currentHeaders, [tempKey]: '' },\n    });\n  };\n\n  const updateHeader = (serverId: string, oldKey: string, newKey: string, value: string) => {\n    const server = state.mcpServers.find((s) => s.id === serverId);\n    if (!server) {\n      return;\n    }\n\n    const currentHeaders = server.headers || {};\n    const keyOrder = Object.keys(currentHeaders);\n\n    // Helper to normalize a key for comparison (trim and extract base from collision markers)\n    const normalizeKey = (k: string): string => {\n      let normalized = k.trim();\n      if (normalized.includes('__collision_')) {\n        normalized = normalized.split('__collision_')[0].trim();\n      }\n      return normalized;\n    };\n\n    // Helper to extract collision ID from a key, if present\n    const getCollisionId = (k: string): string | null => {\n      if (k.includes('__collision_')) {\n        return k.split('__collision_')[1];\n      }\n      return null;\n    };\n\n    // If key changed\n    let finalKey = newKey;\n    if (oldKey !== newKey) {\n      // Check if newKey would collide with an existing key (excluding the one we're editing)\n      // Normalize keys to catch whitespace variants that would collide after save cleanup\n      const normalizedNewKey = normalizeKey(newKey);\n      const existingKeys = keyOrder.filter((k) => k !== oldKey);\n\n      // Find which existing key(s) would conflict\n      const conflictingKey = existingKeys.find((k) => normalizeKey(k) === normalizedNewKey);\n\n      if (normalizedNewKey && conflictingKey) {\n        // Collision detected - determine stable collision ID\n        let uniquePart: string;\n\n        // Priority for stable collision ID:\n        // 1. If oldKey already has a collision marker, preserve its ID\n        // 2. If the conflicting key has a collision marker, use a paired ID\n        // 3. Otherwise generate a new stable ID based on the entry's identity\n        const oldCollisionId = getCollisionId(oldKey);\n        const conflictingCollisionId = getCollisionId(conflictingKey);\n\n        if (oldCollisionId) {\n          // Preserve existing collision ID when editing a collision-marked entry\n          uniquePart = oldCollisionId;\n        } else if (conflictingCollisionId) {\n          // The other entry is marked - create a paired ID to show these two conflict\n          uniquePart = `pair_${conflictingCollisionId}`;\n        } else if (oldKey.startsWith('__new_header_')) {\n          // Use the new header's unique ID\n          uniquePart = oldKey.replace('__new_header_', '');\n        } else {\n          // Generate new ID based on the key content and timestamp\n          uniquePart = `id_${oldKey.replace(/[^a-zA-Z0-9]/g, '_')}_${Date.now()}`;\n        }\n\n        finalKey = `${newKey}__collision_${uniquePart}`;\n      }\n    }\n\n    // Rebuild headers preserving order - replace oldKey with finalKey at the same position\n    const newHeaders: Record<string, string> = {};\n    for (const k of keyOrder) {\n      if (k === oldKey) {\n        newHeaders[finalKey] = value;\n      } else {\n        newHeaders[k] = currentHeaders[k];\n      }\n    }\n\n    updateMCPServer(serverId, { headers: newHeaders });\n  };\n\n  const removeHeader = (serverId: string, key: string) => {\n    const server = state.mcpServers.find((s) => s.id === serverId);\n    if (!server) {\n      return;\n    }\n\n    const currentHeaders = { ...(server.headers || {}) };\n    delete currentHeaders[key];\n\n    updateMCPServer(serverId, { headers: currentHeaders });\n  };\n\n  const onSystemPromptModeChange = (mode: SystemPromptMode) => {\n    setState({\n      ...state,\n      systemPromptMode: mode,\n    });\n\n    // Clear validation error when switching back to default\n    if (mode === 'default') {\n      setValidationErrors((prev) => ({ ...prev, customSystemPrompt: undefined }));\n    } else {\n      // Validate existing custom prompt when switching to replace/append\n      validateCustomPrompt(state.customSystemPrompt, mode);\n    }\n  };\n\n  const onCustomSystemPromptChange = (value: string) => {\n    setState({\n      ...state,\n      customSystemPrompt: value,\n    });\n    validateCustomPrompt(value, state.systemPromptMode);\n  };\n\n  const validateCustomPrompt = (value: string, mode: SystemPromptMode) => {\n    if (mode === 'default') {\n      setValidationErrors((prev) => ({ ...prev, customSystemPrompt: undefined }));\n      return true;\n    }\n\n    const isRequired = mode === 'replace' || mode === 'append';\n\n    try {\n      ValidationService.validateCustomSystemPrompt(value, isRequired);\n      setValidationErrors((prev) => ({ ...prev, customSystemPrompt: undefined }));\n      return true;\n    } catch (error) {\n      setValidationErrors((prev) => ({\n        ...prev,\n        customSystemPrompt: error instanceof Error ? error.message : 'Invalid system prompt',\n      }));\n      return false;\n    }\n  };\n\n  const onSubmitSystemPrompt = () => {\n    if (!validateCustomPrompt(state.customSystemPrompt, state.systemPromptMode)) {\n      return;\n    }\n\n    updatePluginAndReload(plugin.meta.id, {\n      enabled,\n      pinned,\n      jsonData: {\n        ...jsonData,\n        systemPromptMode: state.systemPromptMode,\n        customSystemPrompt: state.customSystemPrompt,\n      },\n    });\n  };\n\n  const isSystemPromptSaveDisabled =\n    state.systemPromptMode !== 'default' && (!state.customSystemPrompt.trim() || !!validationErrors.customSystemPrompt);\n\n  const onSubmitLLMSettings = () => {\n    if (isLLMSettingsDisabled || validationErrors.maxTotalTokens) {\n      return;\n    }\n\n    // Validate before saving\n    try {\n      ValidationService.validateConfigValue('tokenLimit', state.maxTotalTokens);\n    } catch (error) {\n      setValidationErrors((prev) => ({\n        ...prev,\n        maxTotalTokens: error instanceof Error ? error.message : 'Invalid value',\n      }));\n      return;\n    }\n\n    updatePluginAndReload(plugin.meta.id, {\n      enabled,\n      pinned,\n      jsonData: {\n        ...jsonData,\n        maxTotalTokens: state.maxTotalTokens,\n      },\n    });\n  };\n\n  const onSubmitMCPServers = () => {\n    // Validate all MCP servers before saving\n    const errors: ValidationErrors['mcpServers'] = {};\n    let hasErrors = false;\n\n    state.mcpServers.forEach((server) => {\n      const serverErrors: { name?: string; url?: string } = {};\n\n      if (!server.name.trim()) {\n        serverErrors.name = 'Server name is required';\n        hasErrors = true;\n      }\n\n      if (server.url.trim()) {\n        try {\n          ValidationService.validateMCPServerURL(server.url);\n        } catch (error) {\n          serverErrors.url = error instanceof Error ? error.message : 'Invalid URL';\n          hasErrors = true;\n        }\n      }\n\n      if (Object.keys(serverErrors).length > 0) {\n        errors[server.id] = serverErrors;\n      }\n    });\n\n    if (hasErrors) {\n      setValidationErrors((prev) => ({ ...prev, mcpServers: errors }));\n      return;\n    }\n\n    // Check for collision markers (duplicate header keys)\n    const hasDuplicateHeaders = state.mcpServers.some(\n      (server) => server.headers && Object.keys(server.headers).some((key) => key.includes('__collision_'))\n    );\n    if (hasDuplicateHeaders) {\n      // Don't save - the duplicate headers are already highlighted in red\n      return;\n    }\n\n    // Clean up headers before saving - remove entries with empty or temp keys\n    const cleanedServers = state.mcpServers.map((server) => {\n      if (!server.headers) {\n        return server;\n      }\n\n      const cleanedHeaders: Record<string, string> = {};\n      for (const [key, value] of Object.entries(server.headers)) {\n        let cleanKey = key.trim();\n        // Skip empty keys and temp placeholder keys\n        if (!cleanKey || cleanKey.startsWith('__new_header_')) {\n          continue;\n        }\n        // Strip collision markers (shouldn't happen if validation above works)\n        if (cleanKey.includes('__collision_')) {\n          cleanKey = cleanKey.split('__collision_')[0].trim();\n        }\n        cleanedHeaders[cleanKey] = value;\n      }\n\n      return {\n        ...server,\n        headers: Object.keys(cleanedHeaders).length > 0 ? cleanedHeaders : undefined,\n      };\n    });\n\n    updatePluginAndReload(plugin.meta.id, {\n      enabled,\n      pinned,\n      jsonData: {\n        ...jsonData,\n        mcpServers: cleanedServers,\n      },\n    });\n  };\n\n  return (\n    <div>\n      <FieldSet label=\"LLM Settings\">\n        <Field\n          label=\"Max Total Tokens\"\n          description=\"Maximum number of tokens for LLM requests (minimum: 1000, recommended: 50000-200000)\"\n          invalid={!!validationErrors.maxTotalTokens}\n          error={validationErrors.maxTotalTokens}\n        >\n          <Input\n            width={60}\n            name=\"maxTotalTokens\"\n            id=\"config-max-tokens\"\n            data-testid={testIds.appConfig.maxTotalTokens}\n            type=\"number\"\n            value={state.maxTotalTokens}\n            placeholder=\"50000\"\n            min={1000}\n            max={200000}\n            onChange={onChange}\n            invalid={!!validationErrors.maxTotalTokens}\n          />\n        </Field>\n\n        <div className=\"mt-3\">\n          <Button\n            onClick={onSubmitLLMSettings}\n            data-testid={testIds.appConfig.submit}\n            disabled={isLLMSettingsDisabled || !!validationErrors.maxTotalTokens}\n          >\n            Save LLM settings\n          </Button>\n        </div>\n      </FieldSet>\n\n      <FieldSet label=\"MCP Server Connections\" className=\"mt-4\">\n        <p className=\"text-sm text-secondary mb-3\">\n          Configure additional MCP (Model Context Protocol) servers to extend tool capabilities. Supports OpenAPI-based\n          servers like{' '}\n          <a href=\"https://github.com/open-webui/mcpo\" target=\"_blank\" rel=\"noopener noreferrer\">\n            MCPO\n          </a>\n          .\n        </p>\n\n        {state.mcpServers.map((server) => (\n          <div\n            key={server.id}\n            data-testid={testIds.appConfig.mcpServerCard(server.id)}\n            className=\"p-4 mb-3 rounded border\"\n            style={{\n              borderColor: 'var(--grafana-border-medium)',\n              backgroundColor: 'var(--grafana-background-secondary)',\n            }}\n          >\n            <div className=\"flex items-center justify-between mb-3\">\n              <div className=\"flex items-center gap-2\">\n                <Icon name=\"plug\" />\n                <span className=\"font-medium\">{server.name || 'Unnamed Server'}</span>\n              </div>\n              <div className=\"flex items-center gap-2\">\n                <Switch\n                  value={server.enabled}\n                  onChange={(e) => updateMCPServer(server.id, { enabled: e.currentTarget.checked })}\n                />\n                <Button\n                  variant=\"secondary\"\n                  size=\"sm\"\n                  icon=\"trash-alt\"\n                  onClick={() => removeMCPServer(server.id)}\n                  data-testid={testIds.appConfig.mcpServerRemoveButton(server.id)}\n                >\n                  Remove\n                </Button>\n              </div>\n            </div>\n\n            <Field\n              label=\"Server Name\"\n              invalid={!!validationErrors.mcpServers[server.id]?.name}\n              error={validationErrors.mcpServers[server.id]?.name}\n            >\n              <Input\n                width={60}\n                value={server.name}\n                placeholder=\"My MCP Server\"\n                onChange={(e) => updateMCPServer(server.id, { name: e.currentTarget.value })}\n                invalid={!!validationErrors.mcpServers[server.id]?.name}\n                data-testid={testIds.appConfig.mcpServerNameInput(server.id)}\n              />\n            </Field>\n\n            <Field\n              label=\"Server URL\"\n              className=\"mt-2\"\n              invalid={!!validationErrors.mcpServers[server.id]?.url}\n              error={validationErrors.mcpServers[server.id]?.url}\n            >\n              <Input\n                width={60}\n                value={server.url}\n                placeholder=\"https://mcp-server.example.com\"\n                onChange={(e) => updateMCPServer(server.id, { url: e.currentTarget.value })}\n                invalid={!!validationErrors.mcpServers[server.id]?.url}\n                data-testid={testIds.appConfig.mcpServerUrlInput(server.id)}\n              />\n            </Field>\n\n            <Field label=\"Type\" className=\"mt-2\">\n              <select\n                className=\"gf-form-input\"\n                value={server.type || 'openapi'}\n                onChange={(e) =>\n                  updateMCPServer(server.id, {\n                    type: e.target.value as 'openapi' | 'standard' | 'sse' | 'streamable-http',\n                  })\n                }\n                style={{ width: '240px', height: '32px' }}\n              >\n                <option value=\"openapi\">OpenAPI</option>\n                <option value=\"standard\">Standard MCP</option>\n                <option value=\"sse\">SSE</option>\n                <option value=\"streamable-http\">Streamable HTTP</option>\n              </select>\n            </Field>\n\n            {/* Advanced Options Toggle */}\n            <div className=\"mt-3\">\n              <button\n                type=\"button\"\n                onClick={() => toggleAdvancedOptions(server.id)}\n                className=\"flex items-center gap-1 text-sm cursor-pointer bg-transparent border-none p-0\"\n                style={{ color: 'var(--grafana-text-link)' }}\n                data-testid={testIds.appConfig.mcpServerAdvancedToggle(server.id)}\n              >\n                <Icon name={state.expandedAdvanced.has(server.id) ? 'angle-down' : 'angle-right'} />\n                Advanced Options\n                {server.headers && Object.keys(server.headers).length > 0 && (\n                  <span className=\"ml-1 text-xs\" style={{ color: 'var(--grafana-text-secondary)' }}>\n                    ({Object.keys(server.headers).length} header{Object.keys(server.headers).length !== 1 ? 's' : ''})\n                  </span>\n                )}\n              </button>\n            </div>\n\n            {/* Advanced Options Content */}\n            {state.expandedAdvanced.has(server.id) && (\n              <div\n                className=\"mt-2 p-3 rounded\"\n                style={{\n                  backgroundColor: 'var(--grafana-background-canvas)',\n                  border: '1px solid var(--grafana-border-weak)',\n                }}\n              >\n                <div className=\"flex items-center justify-between mb-2\">\n                  <span className=\"text-sm font-medium\">Custom Headers</span>\n                  <span className=\"text-xs\" style={{ color: 'var(--grafana-text-secondary)' }}>\n                    {Object.keys(server.headers || {}).length}/10\n                  </span>\n                </div>\n                <p className=\"text-xs mb-2\" style={{ color: 'var(--grafana-text-secondary)' }}>\n                  Add custom HTTP headers to include with every request to this MCP server.\n                </p>\n\n                {/* Header List */}\n                {Object.entries(server.headers || {}).map(([key, value], index) => {\n                  // Display empty for temp keys, strip collision markers for display\n                  let displayKey = key;\n                  if (key.startsWith('__new_header_')) {\n                    displayKey = '';\n                  } else if (key.includes('__collision_')) {\n                    displayKey = key.split('__collision_')[0];\n                  }\n                  const hasCollision = key.includes('__collision_');\n                  // Use index as key since we preserve order when updating headers\n                  // This maintains focus when editing keys\n                  return (\n                    <div key={`${server.id}-header-${index}`} className=\"mb-2\">\n                      <div className=\"flex items-center gap-2\">\n                        <Input\n                          width={20}\n                          value={displayKey}\n                          placeholder=\"Header key\"\n                          onChange={(e) => updateHeader(server.id, key, e.currentTarget.value, value)}\n                          data-testid={testIds.appConfig.mcpServerHeaderKeyInput(server.id, index)}\n                          invalid={hasCollision}\n                        />\n                        <Input\n                          width={30}\n                          value={value}\n                          placeholder=\"Header value\"\n                          onChange={(e) => updateHeader(server.id, key, key, e.currentTarget.value)}\n                          data-testid={testIds.appConfig.mcpServerHeaderValueInput(server.id, index)}\n                        />\n                        <Button\n                          variant=\"secondary\"\n                          size=\"sm\"\n                          icon=\"times\"\n                          onClick={() => removeHeader(server.id, key)}\n                          data-testid={testIds.appConfig.mcpServerHeaderRemoveButton(server.id, index)}\n                          aria-label=\"Remove header\"\n                        />\n                      </div>\n                      {hasCollision && (\n                        <span className=\"text-xs mt-1 block\" style={{ color: 'var(--grafana-text-error)' }}>\n                          Duplicate key name\n                        </span>\n                      )}\n                    </div>\n                  );\n                })}\n\n                {/* Add Header Button */}\n                {(() => {\n                  const headers = server.headers || {};\n                  const headerKeys = Object.keys(headers);\n                  const atMaxHeaders = headerKeys.length >= 10;\n                  // Check if any header has an empty, temp, or collision key\n                  const hasIncompleteHeader = headerKeys.some(\n                    (key) => key.startsWith('__new_header_') || !key.trim() || key.includes('__collision_')\n                  );\n\n                  if (atMaxHeaders) {\n                    return null;\n                  }\n\n                  return (\n                    <Button\n                      variant=\"secondary\"\n                      size=\"sm\"\n                      icon=\"plus\"\n                      onClick={() => addHeader(server.id)}\n                      disabled={hasIncompleteHeader}\n                      data-testid={testIds.appConfig.mcpServerAddHeaderButton(server.id)}\n                    >\n                      Add Header\n                    </Button>\n                  );\n                })()}\n              </div>\n            )}\n          </div>\n        ))}\n\n        <Button\n          variant=\"secondary\"\n          icon=\"plus\"\n          onClick={addMCPServer}\n          data-testid={testIds.appConfig.addMcpServerButton}\n        >\n          Add MCP Server\n        </Button>\n\n        <div className=\"mt-3\">\n          {Object.keys(validationErrors.mcpServers).length > 0 && (\n            <Alert severity=\"error\" title=\"Validation errors\" className=\"mb-3\">\n              Please fix the validation errors above before saving.\n            </Alert>\n          )}\n          <Button\n            onClick={onSubmitMCPServers}\n            variant=\"primary\"\n            disabled={Object.keys(validationErrors.mcpServers).length > 0}\n            data-testid={testIds.appConfig.saveMcpServersButton}\n          >\n            Save MCP Server Connections\n          </Button>\n        </div>\n      </FieldSet>\n\n      <FieldSet label=\"System Prompt\" className=\"mt-4\">\n        <p className=\"text-sm text-secondary mb-3\">\n          Customize the system prompt that instructs the AI assistant. You can use the default observability-focused\n          prompt, replace it entirely with your own, or append additional instructions to it.\n        </p>\n\n        <Field label=\"Prompt Mode\" description=\"Choose how to configure the system prompt\">\n          <RadioButtonGroup\n            options={PROMPT_MODE_OPTIONS}\n            value={state.systemPromptMode}\n            onChange={onSystemPromptModeChange}\n            data-testid={testIds.appConfig.systemPromptModeSelector}\n          />\n        </Field>\n\n        {state.systemPromptMode !== 'default' && (\n          <Field\n            label=\"Custom System Prompt\"\n            description={\n              state.systemPromptMode === 'replace'\n                ? 'Enter your complete custom system prompt'\n                : 'Enter additional instructions to append to the default prompt'\n            }\n            className=\"mt-3\"\n            invalid={!!validationErrors.customSystemPrompt}\n            error={validationErrors.customSystemPrompt}\n          >\n            <TextArea\n              value={state.customSystemPrompt}\n              onChange={(e) => onCustomSystemPromptChange(e.currentTarget.value)}\n              rows={8}\n              placeholder={\n                state.systemPromptMode === 'replace'\n                  ? 'You are a helpful assistant that...'\n                  : 'Additional instructions:\\n- Always provide code examples\\n- Focus on performance optimization'\n              }\n              invalid={!!validationErrors.customSystemPrompt}\n              data-testid={testIds.appConfig.customSystemPromptTextarea}\n            />\n          </Field>\n        )}\n\n        {state.systemPromptMode !== 'default' && (\n          <p className=\"text-sm text-secondary mt-1\" data-testid={testIds.appConfig.customSystemPromptCharCount}>\n            Characters: {state.customSystemPrompt.length} / {ValidationService.MAX_SYSTEM_PROMPT_LENGTH}\n            {state.customSystemPrompt.length > ValidationService.MAX_SYSTEM_PROMPT_LENGTH * 0.8 && (\n              <span className=\"text-warning ml-2\">(Approaching limit - long prompts may impact performance)</span>\n            )}\n          </p>\n        )}\n\n        <div className=\"mt-3 flex gap-2\">\n          <Button\n            variant=\"secondary\"\n            onClick={() => setShowDefaultPromptModal(true)}\n            icon=\"eye\"\n            data-testid={testIds.appConfig.viewDefaultPromptButton}\n          >\n            View Default Prompt\n          </Button>\n          <Button\n            onClick={onSubmitSystemPrompt}\n            variant=\"primary\"\n            disabled={isSystemPromptSaveDisabled}\n            data-testid={testIds.appConfig.saveSystemPromptButton}\n          >\n            Save System Prompt\n          </Button>\n        </div>\n      </FieldSet>\n\n      <Modal\n        title=\"Default System Prompt\"\n        isOpen={showDefaultPromptModal}\n        onDismiss={() => setShowDefaultPromptModal(false)}\n        data-testid={testIds.appConfig.defaultPromptModal}\n      >\n        <div className=\"p-2\">\n          <p className=\"text-sm text-secondary mb-3\">\n            This is the default system prompt used by the Observability Assistant. It instructs the AI to specialize in\n            the Grafana LGTM stack and use MCP tools.\n          </p>\n          <pre\n            className=\"p-3 rounded text-sm overflow-auto\"\n            style={{\n              backgroundColor: 'var(--grafana-background-secondary)',\n              border: '1px solid var(--grafana-border-weak)',\n              maxHeight: '400px',\n              whiteSpace: 'pre-wrap',\n              wordBreak: 'break-word',\n            }}\n            data-testid={testIds.appConfig.defaultPromptContent}\n          >\n            {SYSTEM_PROMPT}\n          </pre>\n          <div className=\"mt-3 flex justify-end gap-2\">\n            <Button\n              variant=\"secondary\"\n              onClick={async () => {\n                try {\n                  await navigator.clipboard.writeText(SYSTEM_PROMPT);\n                  setCopySuccess(true);\n                  setTimeout(() => setCopySuccess(false), 2000);\n                } catch (err) {\n                  console.error('Failed to copy system prompt:', err);\n                }\n              }}\n              icon={copySuccess ? 'check' : 'copy'}\n              data-testid={testIds.appConfig.copyDefaultPromptButton}\n            >\n              {copySuccess ? 'Copied!' : 'Copy to Clipboard'}\n            </Button>\n            <Button\n              variant=\"primary\"\n              onClick={() => setShowDefaultPromptModal(false)}\n              data-testid={testIds.appConfig.closeDefaultPromptButton}\n            >\n              Close\n            </Button>\n          </div>\n        </div>\n      </Modal>\n    </div>\n  );\n};\n\nexport default AppConfig;\n\nconst updatePluginAndReload = async (pluginId: string, data: Partial<PluginMeta<AppPluginSettings>>) => {\n  try {\n    await updatePlugin(pluginId, data);\n\n    // Reloading the page as the changes made here wouldn't be propagated to the actual plugin otherwise.\n    // This is not ideal, however unfortunately currently there is no supported way for updating the plugin state.\n    window.location.reload();\n  } catch (e) {\n    console.error('Error while updating the plugin', e);\n  }\n};\n\nconst updatePlugin = async (pluginId: string, data: Partial<PluginMeta>) => {\n  const response = await getBackendSrv().fetch({\n    url: `/api/plugins/${pluginId}/settings`,\n    method: 'POST',\n    data,\n  });\n\n  return lastValueFrom(response);\n};\n"],"names":["testIds","appConfig","apiKey","apiUrl","maxTotalTokens","submit","addMcpServerButton","saveMcpServersButton","mcpServerCard","id","mcpServerNameInput","mcpServerUrlInput","mcpServerRemoveButton","mcpServerAdvancedToggle","mcpServerAddHeaderButton","mcpServerHeaderKeyInput","index","mcpServerHeaderValueInput","mcpServerHeaderRemoveButton","systemPromptModeSelector","customSystemPromptTextarea","customSystemPromptCharCount","viewDefaultPromptButton","saveSystemPromptButton","defaultPromptModal","defaultPromptContent","copyDefaultPromptButton","closeDefaultPromptButton","home","container","PROMPT_MODE_OPTIONS","label","value","plugin","enabled","pinned","jsonData","meta","state","setState","useState","mcpServers","systemPromptMode","customSystemPrompt","expandedAdvanced","Set","validationErrors","setValidationErrors","showDefaultPromptModal","setShowDefaultPromptModal","copySuccess","setCopySuccess","isLLMSettingsDisabled","Boolean","updateMCPServer","updates","map","server","newErrors","undefined","url","trim","ValidationService","validateMCPServerURL","Object","keys","length","error","Error","message","name","prev","headerIdCounterRef","React","updateHeader","serverId","oldKey","newKey","find","s","currentHeaders","headers","keyOrder","normalizeKey","k","normalized","includes","split","getCollisionId","finalKey","normalizedNewKey","conflictingKey","filter","uniquePart","oldCollisionId","conflictingCollisionId","startsWith","replace","Date","now","newHeaders","validateCustomPrompt","mode","isRequired","validateCustomSystemPrompt","isSystemPromptSaveDisabled","div","FieldSet","Field","description","invalid","Input","width","data-testid","type","placeholder","min","max","onChange","event","target","parsedValue","parseInt","validateConfigValue","className","Button","onClick","updatePluginAndReload","disabled","p","a","href","rel","key","style","borderColor","backgroundColor","Icon","span","Switch","e","currentTarget","checked","variant","size","icon","removeMCPServer","select","height","option","button","toggleAdvancedOptions","newExpanded","has","delete","add","color","border","entries","displayKey","hasCollision","removeHeader","aria-label","headerKeys","atMaxHeaders","hasIncompleteHeader","some","current","tempKey","addHeader","newServer","Alert","severity","title","errors","hasErrors","forEach","serverErrors","cleanedServers","cleanedHeaders","cleanKey","RadioButtonGroup","options","TextArea","onCustomSystemPromptChange","rows","MAX_SYSTEM_PROMPT_LENGTH","Modal","isOpen","onDismiss","pre","maxHeight","whiteSpace","wordBreak","SYSTEM_PROMPT","navigator","clipboard","writeText","setTimeout","err","console","pluginId","data","updatePlugin","window","location","reload","response","getBackendSrv","fetch","method","lastValueFrom"],"ignoreList":[],"sourceRoot":""}